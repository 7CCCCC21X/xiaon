<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Binance Alpha ä»£å¸ç°è´§ / åˆçº¦ä¸Šçº¿æƒ…å†µ</title>
  <style>
    :root{
      --bg:#f9fafb;--card:#ffffff;--text:#1f2937;--sub:#6b7280;
      --green:#16a34a;--red:#dc2626;--border:#e5e7eb;--primary:#2563eb;
    }
    @media(prefers-color-scheme:dark){
      :root{--bg:#1e293b;--card:#1f2937;--text:#f3f4f6;--sub:#94a3b8;--border:#334155;}
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,"Segoe UI","PingFang SC",sans-serif;}
    body{background:var(--bg);color:var(--text);line-height:1.5;padding:20px;}
    h1{text-align:center;margin-bottom:20px;color:var(--primary);}
    section{margin-bottom:40px;}
    table{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);}
    th,td{padding:8px 6px;border-bottom:1px solid var(--border);text-align:left;}
    th{background:var(--bg);user-select:none;}
    img.ico{width:24px;height:24px;border-radius:50%;vertical-align:middle;}
    .badge{font-size:12px;padding:2px 6px;border-radius:4px;color:#fff;}
    .badge.spot{background:var(--green);}  .badge.perp{background:var(--primary);}
    .loading{text-align:center;color:var(--sub);margin-top:10px;}
    .toolbar{margin:6px 0 12px;display:flex;align-items:center;gap:6px;font-size:14px;color:var(--sub);}
    input[type="checkbox"]{transform:scale(1.1);cursor:pointer;}
    .sortable{cursor:pointer;}
  </style>
</head>
<body>
  <h1>Binance Alpha ä»£å¸ä¸Šçº¿ä¸€è§ˆ</h1>

  <section>
    <h2>âœ… å·²ä¸Šçº¿ç°è´§ (Spot)</h2>
    <div id="spotTable"></div>
  </section>

  <section>
    <h2>ğŸ“ˆ å·²ä¸Šçº¿åˆçº¦ (PerpetualÂ Futures)</h2>
    <div class="toolbar">
      <label><input type="checkbox" id="hideDup"> éšè—å·²ä¸Šçº¿ç°è´§çš„ä»£å¸</label>
    </div>
    <div id="perpTable"></div>
  </section>

<script>
(async () => {
  const spotDiv   = document.getElementById('spotTable');
  const perpDiv   = document.getElementById('perpTable');
  const hideDupCB = document.getElementById('hideDup');
  const loading   = '<p class="loading">åŠ è½½ä¸­â€¦</p>';
  spotDiv.innerHTML = perpDiv.innerHTML = loading;

  let sortAsc = false;
  let spotList = [], perpList = [];
  const color = v => (+v) >= 0 ? 'var(--green)' : 'var(--red)';
  const fmt   = n => (+n).toLocaleString(undefined,{maximumFractionDigits:0});

  try {
    const [alphaRes, futRes] = await Promise.all([
      fetch('https://www.binance.com/bapi/defi/v1/public/wallet-direct/buw/wallet/cex/alpha/all/token/list'),
      fetch('https://fapi.binance.com/fapi/v1/exchangeInfo')
    ]);

    const tokens  = (await alphaRes.json()).data || [];
    const futSyms = (await futRes.json()).symbols.map(s => s.symbol);

    tokens.forEach(t => {
      const s = t.symbol.toUpperCase();
      if (t.listingCex) spotList.push(t);
      if (futSyms.includes(s + 'USDT')) perpList.push(t);
    });

    const spotSet = new Set(spotList.map(t=>t.symbol.toUpperCase()));
    renderSpot();
    renderPerp();
    hideDupCB.onchange = renderPerp;

  } catch (err){
    spotDiv.innerHTML = perpDiv.innerHTML =
      '<p class="loading" style="color:var(--red)">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼</p>';
    console.error(err);
  }

  const rowTpl = (arr, tag, showMcap) => arr.map(a => `
    <tr>
      <td><img class="ico" loading="lazy" referrerpolicy="no-referrer"
           src="${a.iconUrl}" alt=""
           onerror="this.style.display='none'"></td>
      <td>${a.name}</td>
      <td>${a.symbol}</td>
      <td style="color:${color(a.percentChange24h)}">${(+a.percentChange24h).toFixed(2)}%</td>
      <td>${(+a.price).toFixed(6)}</td>
      ${showMcap ? `<td>${fmt(a.marketCap)}</td>` : ''}
      <td><span class="badge ${tag==='ç°è´§å·²ä¸Š'?'spot':'perp'}">${tag}</span></td>
    </tr>`).join('');

  function renderSpot(){
    spotDiv.innerHTML = spotList.length ? `
      <table>
        <thead><tr>
          <th>å›¾æ ‡</th><th>åç§°</th><th>ç¬¦å·</th><th>24h æ¶¨è·Œ%</th><th>ä»·æ ¼ (USD)</th><th></th>
        </tr></thead>
        <tbody>${rowTpl(spotList,'ç°è´§å·²ä¸Š',false)}</tbody>
      </table>` : loading;
  }

  function renderPerp(){
    let arr = hideDupCB.checked
      ? perpList.filter(t => !spotList.some(s => s.symbol===t.symbol))
      : perpList.slice();

    arr.sort((a,b)=> sortAsc ? (+a.marketCap - +b.marketCap) : (+b.marketCap - +a.marketCap));

    perpDiv.innerHTML = arr.length ? `
      <table>
        <thead><tr>
          <th>å›¾æ ‡</th><th>åç§°</th><th>ç¬¦å·</th><th>24h æ¶¨è·Œ%</th><th>ä»·æ ¼ (USD)</th>
          <th id="mcapHeader" class="sortable">æµé€šå¸‚å€¼ (USD) ${sortAsc?'â–²':'â–¼'}</th><th></th>
        </tr></thead>
        <tbody>${rowTpl(arr,'åˆçº¦å·²ä¸Š',true)}</tbody>
      </table>` : '<p class="loading">(ç©º)</p>';

    document.getElementById('mcapHeader').onclick = ()=>{ sortAsc=!sortAsc; renderPerp(); };
  }
})();
</script>
</body>
</html>
